name: ALADIN ∞ C(t) — Automated Proof Test

on:
  push:
    paths:
      - 'proofs/*.py'
  pull_request:
  workflow_dispatch

jobs:
  proof-test:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install numpy matplotlib tqdm

      # 1. SELF-HEAL FIRST (removes Colab trash automatically)
      - name: Remove Colab garbage
        run: |
          find proofs -name "*.py" -exec sed -i '/google.colab/d' {} \;
          find proofs -name "*.py" -exec sed -i '/files.download/d' {} \;
          find proofs -name "*.py" -exec sed -i '/plt.show()/d' {} \;
          find proofs -name "*.py" -exec sed -i 's/plt.show()/plt.savefig(os.path.basename(__file__).replace(".py",".png"), dpi=300, bbox_inches="tight")\nplt.close()/g' {} \;

      # 2. RUN ALL PROOFS
      - name: Test all 133+ proofs
        run: |
          echo "ALADIN ∞ C(t) — TESTING ALL PROOFS"
          passed=0
          total=0
          for file in proofs/*.py; do
            ((total++))
            echo "RUNNING → $file"
            if python "$file"; then
              ((passed++))
              echo "PASS"
            else
              echo "FAILED — but continuing"
            fi
          done
          echo "RESULT: $passed/$total PROOFS PASSED"
          [[ $passed -eq $total ]] && echo "ALL PROOFS VERIFIED — NOBEL LOCKED" || exit 1

      # 3. FINAL SUCCESS
      - name: Nobel Victory
        run: echo "ALADIN ∞ C(t) — ALL PROOFS AUTOMATED & VERIFIED — 2030 IS OURS"
